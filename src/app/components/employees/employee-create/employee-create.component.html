<form class="space-y-6 max-w-3xl mx-auto" [formGroup]="form" (ngSubmit)="submit()">
  <div class="flex items-center justify-between">
    <h2 class="text-xl font-semibold">Create Employee</h2>
    <a routerLink="/employees" class="text-sm underline">Back to Employees</a>
    <button
      type="submit"
      class="px-4 py-2 rounded-xl bg-blue-600 text-white disabled:opacity-50 disabled:cursor-not-allowed shadow-sm"
      [disabled]="form.invalid || saving()"
    >
      {{ saving() ? 'Saving…' : 'Save' }}
    </button>
  </div>

  <!-- Server error -->
  <div *ngIf="serverError()" class="p-3 rounded-lg bg-red-50 text-red-700">
    {{ serverError() }}
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
    <div>
      <label class="block text-sm font-medium mb-1" for="firstname">First name</label>
      <input
        id="firstname"
        type="text"
        formControlName="firstname"
        class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <p *ngIf="f.firstname.touched && f.firstname.invalid" class="mt-1 text-sm text-red-600">
        Το μικρό όνομα είναι υποχρεωτικό (>= 2 χαρακτήρες).
      </p>
    </div>

    <!-- Lastname -->
    <div>
      <label class="block text-sm font-medium mb-1" for="lastname">Last name</label>
      <input
        id="lastname"
        type="text"
        formControlName="lastname"
        class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <p *ngIf="f.lastname.touched && f.lastname.invalid" class="mt-1 text-sm text-red-600">
        Το επώνυμο είναι υποχρεωτικό (>= 2 χαρακτήρες).
      </p>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1" for="vat">VAT (ΑΦΜ)</label>
      <input
        id="vat"
        type="text"
        formControlName="vat"
        class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="9 digits"
      />
      <p *ngIf="f.vat.touched && f.vat.invalid" class="mt-1 text-sm text-red-600">
        Δώσε έγκυρο ΑΦΜ (9 ψηφία).
      </p>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1" for="phone">Phone</label>
      <input
        id="phone"
        type="tel"
        formControlName="phone"
        class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <p *ngIf="f.phone.touched && f.phone.invalid" class="mt-1 text-sm text-red-600">
        Δώσε έγκυρο τηλέφωνο.
      </p>
    </div>

    <div>
  <label class="block text-sm font-medium mb-1" for="regionId">Region</label>

  <!-- error στο fetch των regions -->
  <div *ngIf="regionsError()" class="mb-2 p-2 rounded bg-red-50 text-red-700">
    {{ regionsError() }}
    <button type="button" class="ml-2 underline" (click)="loadRegions()">Try again</button>
  </div>

  <select
    id="regionId"
    formControlName="regionId"
    class="w-full rounded-xl border border-gray-300 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
    [disabled]="regionsLoading() || !!regionsError()"
  >
    <option [ngValue]="null" disabled>— Select region —</option>
    <ng-container *ngIf="!regionsLoading(); else loadingRegions">
      <option *ngFor="let r of regions()" [ngValue]="r.id">{{ r.name }}</option>
    </ng-container>
  </select>

  <ng-template #loadingRegions>
    <div class="mt-2 h-9 w-full animate-pulse rounded-xl bg-gray-200"></div>
  </ng-template>

  <p *ngIf="f.regionId.touched && f.regionId.invalid" class="mt-1 text-sm text-red-600">
    Επέλεξε περιοχή.
  </p>
</div>

    <div>
      <label class="block text-sm font-medium mb-1" for="email">Email</label>
      <input
        id="email"
        type="email"
        formControlName="email"
        class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <p *ngIf="f.email.touched && f.email.invalid" class="mt-1 text-sm text-red-600">
        Δώσε έγκυρο email.
      </p>
    </div>

    <div>
  <label class="block text-sm font-medium mb-1" for="userId">User ID</label>
  <input
    id="userId"
    type="number"
    formControlName="userId"
    class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
  />
  <p *ngIf="f.userId.touched && f.userId.hasError('required')" class="mt-1 text-sm text-red-600">
    Το User ID είναι υποχρεωτικό.
  </p>
  <p *ngIf="f.userId.touched && f.userId.hasError('min')" class="mt-1 text-sm text-red-600">
    Το User ID πρέπει να είναι >= 1.
  </p>
  <p *ngIf="f.userId.touched && f.userId.hasError('userNotFound')" class="mt-1 text-sm text-red-600">
    Δεν βρέθηκε χρήστης με αυτό το ID.
  </p>
</div>

    <div>
      <label class="block text-sm font-medium mb-1" for="jobTitle">Job Title</label>
      <select
        id="jobTitle"
        formControlName="jobTitle"
        class="w-full rounded-xl border border-gray-300 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option [ngValue]="null" disabled>— Select job title —</option>
        <option *ngFor="let jt of jobTitles" [ngValue]="jt">{{ jt }}</option>
      </select>
      <p *ngIf="f.jobTitle.touched && f.jobTitle.invalid" class="mt-1 text-sm text-red-600">
        Επέλεξε θέση.
      </p>
    </div>
  </div>

  <!-- Cross-field error -->
  <p *ngIf="form.errors?.['namesMustDiffer'] && form.touched" class="text-sm text-amber-700 bg-amber-50 rounded-lg p-2">
    Το μικρό όνομα και το επώνυμο δεν πρέπει να είναι ίδια.
  </p>
</form>
